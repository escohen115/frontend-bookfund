{"ast":null,"code":"import _slicedToArray from\"/Users/simoncohen/Flatiron/code/Mod5/bookfund/frontend-bookfund/bookfund/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import BackEndBookCard from'../BookIndex/BackEndBookCard';import{useParams}from\"react-router-dom\";import{Card,Button,Image}from'semantic-ui-react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function OtherUserPage(_ref){var savedBooks=_ref.savedBooks,timeLeft=_ref.timeLeft,setTimeLeft=_ref.setTimeLeft,reviewLeft=_ref.reviewLeft,setReviewLeft=_ref.setReviewLeft;var waitingsMapped=[];var waitingsFulFilledMapped=[];var mostRecent={};var foundBook=null;var foundReview=null;var receivedMapped=null;var waitlistMapped=null;var displayTimer=false;var sponsoredWaitings=[];var sponsoredMapped=[];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),allWaitings=_useState2[0],setAllWaitings=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),index=_useState4[0],setIndex=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),waitlistIndex=_useState6[0],setWaitlistIndex=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),sponsoredIndex=_useState8[0],setSponsoredIndex=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),user=_useState10[0],setUser=_useState10[1];var params=useParams();useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/users/\").concat(params.id)).then(function(response){return response.json();}).then(function(data){return setUser(data);});},[params.id]);useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/waitings\")).then(function(response){return response.json();}).then(function(data){return setAllWaitings(data);});},[]);if(user){(function(){if(user.waitings.length<1){console.log(\"setTimeLeft(false)\");setTimeLeft(false);setReviewLeft(true);}var waitingsUnfulfilled=user.waitings.filter(function(waiting){return waiting.fulfilled!==true;});//get all unfulfilled waitings for a user\nvar _loop=function _loop(i){waitingsMapped.push(savedBooks.find(function(saved_book){return saved_book.id===waitingsUnfulfilled[i].book_id;}));//create an array of those books by comparing to saved books\n};for(var i=0;i<waitingsUnfulfilled.length;i++){_loop(i);}if(waitingsMapped.length>0){waitlistMapped=waitingsMapped.map(function(waiting){//create JSX of books\nreturn/*#__PURE__*/_jsx(BackEndBookCard,{book:waiting});});}if(allWaitings.length>0){sponsoredWaitings=allWaitings.filter(function(waiting){return waiting.sponsor_id===user.id;});if(sponsoredWaitings.length>0){var arrTwo=[];arrTwo.push(sponsoredWaitings[0]);var _loop2=function _loop2(_i){if(arrTwo.find(function(elem){return elem.book_id===sponsoredWaitings[_i].book_id;})){}else{arrTwo.push(sponsoredWaitings[_i]);}};for(var _i=1;_i<sponsoredWaitings.length;_i++){_loop2(_i);}sponsoredMapped=arrTwo.map(function(waiting){//create JSX of books\nreturn/*#__PURE__*/_jsx(BackEndBookCard,{book:savedBooks.find(function(savedBook){return savedBook.id===waiting.book_id;})});});}}var waitingsFulfilled=user.waitings.filter(function(waiting){return waiting.fulfilled===true;});//get all fulfilled waitings for a user\nvar _loop3=function _loop3(_i2){waitingsFulFilledMapped.push(savedBooks.find(function(saved_book){return saved_book.id===waitingsFulfilled[_i2].book_id;}));//create an array of those books by comparing to saved books\n};for(var _i2=0;_i2<waitingsFulfilled.length;_i2++){_loop3(_i2);}if(waitingsFulfilled.length<1){setReviewLeft(true);}if(savedBooks.length>0){receivedMapped=waitingsFulFilledMapped.map(function(waiting){//create JSX of books\nreturn/*#__PURE__*/_jsx(BackEndBookCard,{book:waiting});});}if(waitingsFulfilled.length>0){mostRecent=waitingsFulfilled.sort(function(a,b){// find most recent received\nreturn b.id-a.id;})[0];if(Object.keys(mostRecent).length!==0){// if theres not most recent book\n//check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\nvar creationDate=new Date(parseInt(mostRecent.sponsor_date)+60000).getTime();var now=new Date().getTime();if(now<creationDate){// wait period has not passed\ndisplayTimer=true;}else{displayTimer=false;console.log(\"setTimeLeft(false)\");setTimeLeft(false);}}foundBook=savedBooks.find(function(book){return book.id===mostRecent.book_id;});// find most recently received book based on most recent waiting\nif(foundBook){foundReview=foundBook.reviews.find(function(review){return review.user.id===user.id;});// check if they left a review on it\nif(foundReview){setReviewLeft(true);}else{setReviewLeft(false);//if book was found without a review\n}}else{// if no book is on received list\nsetReviewLeft(true);}}})();}function handleNextClick(){if(waitlistIndex<waitlistMapped.length){if(waitlistMapped.length-waitlistIndex>8){setWaitlistIndex(waitlistIndex+8);}else{setWaitlistIndex(0);}}}if(user){console.log('timeleft:',timeLeft);console.log('reviewleft:',reviewLeft);return/*#__PURE__*/_jsxs(\"div\",{className:\"userpage\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"userpage-top-half\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"userpage-eligibility-info\",style:{float:'left'},children:user.eligible?/*#__PURE__*/_jsxs(\"h3\",{children:[\"Looks like \",user.username,\" is eligible for their next book!\"]}):/*#__PURE__*/_jsxs(\"h3\",{children:[\"Looks like \",user.username,\" needs to wait two weeks or leave a review to be eligible for their next book!\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"userpage-user-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Profile\"}),/*#__PURE__*/_jsx(Image,{src:user.profile_pic?user.profile_pic:null,size:\"small\",circular:true,style:{float:'left'}}),/*#__PURE__*/_jsxs(\"div\",{style:{float:'left',marginLeft:'50px'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Name: \"}),user.name?user.name:null,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Email: \"}),user.email?user.email:null,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Username: \"}),user.username?user.username:null,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Bio: \"}),user.bio?user.bio:null]})]})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"pop\",children:\"Waitlist\"}),waitingsMapped.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"userpage-book-display\",children:/*#__PURE__*/_jsx(Card.Group,{itemsPerRow:8,children:waitlistMapped.slice(waitlistIndex,waitlistIndex+8)})}),/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:handleNextClick,children:\"Next\"}),waitlistIndex>0?/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return setIndex(waitlistIndex-8);},children:\"Back\"}):null]}):null,/*#__PURE__*/_jsx(\"h3\",{className:\"pop\",children:\"Received\"}),waitingsFulFilledMapped.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"userpage-book-display\",children:/*#__PURE__*/_jsx(Card.Group,{itemsPerRow:8,children:receivedMapped.slice(index,index+8)})}),/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return setIndex(index+8);},children:\"Next\"}),index>0?/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return setIndex(index-8);},children:\"Back\"}):null]}):null,/*#__PURE__*/_jsx(\"h3\",{className:\"pop\",children:\"Sponsored\"}),sponsoredMapped.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"userpage-book-display\",children:/*#__PURE__*/_jsx(Card.Group,{itemsPerRow:8,children:sponsoredMapped.slice(sponsoredIndex,sponsoredIndex+8)})}),/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return setSponsoredIndex(sponsoredIndex+8);},children:\"Next\"}),sponsoredIndex>0?/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return setSponsoredIndex(sponsoredIndex-8);},children:\"Back\"}):null]}):null]});}else{return/*#__PURE__*/_jsx(_Fragment,{children:\"Loading\"});}}// export default function OtherUserPage({savedBooks}){\n//     const [otherUser, setOtherUser] = useState(null)\n//     const params = useParams()\n//     let waitingsMapped = []\n//     let waitlistMapped = []\n//     useEffect(()=>{\n//         fetch(`${process.env.REACT_APP_API_BASE_URL}/users/${params.id}`)\n//         .then(response => response.json())\n//         .then(data=>setOtherUser(data))  \n//     },[])\n//     if (otherUser && savedBooks.length > 0){  \n//         let waitingsUnfulfilled = otherUser.waitings.filter(waiting=>waiting.fulfilled!==true)\n//         for(let i=0;i<waitingsUnfulfilled.length;i++){\n//         waitingsMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsUnfulfilled[i].book_id))\n//         } \n//         waitlistMapped = waitingsMapped.map(waiting=>{\n//             return (<BackEndBookCard book={waiting}/>)\n//         })\n//         return(\n//             <div> \n//                 <img src={otherUser.profile_pic ? otherUser.profile_pic : null}></img>\n//                 <p>name: {otherUser.name ? otherUser.name : null}</p>\n//                 <p>email: {otherUser.email ? otherUser.email : null}</p>\n//                 <p>username: {otherUser.username ? otherUser.username : null }</p>\n//                 <p>bio: {otherUser.bio ? otherUser.bio : null}</p>\n//                 <p>waitlist:</p>\n//                 <ul>{waitingsMapped.length > 0 ? waitlistMapped:null}</ul>\n//             </div>\n//         )\n//     }\n//     else{\n//         return <p>loading</p>\n//     }\n// }","map":{"version":3,"sources":["/Users/simoncohen/Flatiron/code/Mod5/bookfund/frontend-bookfund/bookfund/src/components/pages/OtherUserPage/OtherUserPage.js"],"names":["React","useEffect","useState","BackEndBookCard","useParams","Card","Button","Image","OtherUserPage","savedBooks","timeLeft","setTimeLeft","reviewLeft","setReviewLeft","waitingsMapped","waitingsFulFilledMapped","mostRecent","foundBook","foundReview","receivedMapped","waitlistMapped","displayTimer","sponsoredWaitings","sponsoredMapped","allWaitings","setAllWaitings","index","setIndex","waitlistIndex","setWaitlistIndex","sponsoredIndex","setSponsoredIndex","user","setUser","params","fetch","process","env","REACT_APP_API_BASE_URL","id","then","response","json","data","waitings","length","console","log","waitingsUnfulfilled","filter","waiting","fulfilled","i","push","find","saved_book","book_id","map","sponsor_id","arrTwo","elem","savedBook","waitingsFulfilled","sort","a","b","Object","keys","creationDate","Date","parseInt","sponsor_date","getTime","now","book","reviews","review","handleNextClick","float","eligible","username","profile_pic","marginLeft","display","name","email","bio","slice"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\nimport BackEndBookCard from '../BookIndex/BackEndBookCard'\nimport {  useParams } from \"react-router-dom\";\nimport { Card, Button, Image } from 'semantic-ui-react'\n\n\n\nexport default function OtherUserPage({savedBooks, timeLeft, setTimeLeft, reviewLeft, setReviewLeft}){\n\n    let waitingsMapped = []\n    let waitingsFulFilledMapped = []\n    let mostRecent = {}\n    let foundBook = null\n    let foundReview = null\n    let receivedMapped = null\n    let waitlistMapped = null\n    let displayTimer = false\n    let sponsoredWaitings = []\n    let sponsoredMapped = []\n    \n    const [allWaitings, setAllWaitings] = useState([])\n    const [index, setIndex] = useState(0)\n    const [waitlistIndex, setWaitlistIndex] = useState(0)\n    const [sponsoredIndex, setSponsoredIndex] = useState(0)\n    const [user, setUser] = useState(null)\n    const params = useParams()\n\n    useEffect(()=>{\n        fetch(`${process.env.REACT_APP_API_BASE_URL}/users/${params.id}`)\n        .then(response => response.json())\n        .then(data=>setUser(data))  \n    },[params.id])\n    \n\n    useEffect(()=>{\n    fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`)\n    .then(response=>response.json())\n    .then(data=> setAllWaitings(data))\n    },[])\n    \n    if (user){ \n        if (user.waitings.length < 1){\n            console.log(`setTimeLeft(false)`)\n             setTimeLeft(false)\n             setReviewLeft(true)\n        }\n\n        let waitingsUnfulfilled = user.waitings.filter(waiting=>waiting.fulfilled!==true)//get all unfulfilled waitings for a user\n        for(let i=0;i<waitingsUnfulfilled.length;i++){\n            waitingsMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsUnfulfilled[i].book_id))//create an array of those books by comparing to saved books\n        } \n        if (waitingsMapped.length > 0){\n            waitlistMapped = waitingsMapped.map(waiting=>{ //create JSX of books\n                return (<BackEndBookCard book={waiting}/>)\n            })\n        }\n        if (allWaitings.length > 0){\n            sponsoredWaitings = allWaitings.filter(waiting=>waiting.sponsor_id === user.id)\n\n            \n            if (sponsoredWaitings.length > 0){\n                let arrTwo = []\n                arrTwo.push(sponsoredWaitings[0])\n                for (let i=1;i < sponsoredWaitings.length;i++){\n                    if (arrTwo.find(elem=>elem.book_id===sponsoredWaitings[i].book_id))\n                    {\n                        \n                    }\n                    else{\n                        arrTwo.push(sponsoredWaitings[i])\n                    }\n                    \n                }\n\n                sponsoredMapped = arrTwo.map(waiting=>{ //create JSX of books\n                    return (<BackEndBookCard book={savedBooks.find(savedBook => savedBook.id === waiting.book_id)}/>)\n                })\n            }\n            }        \n\n\n        let waitingsFulfilled = user.waitings.filter(waiting=>waiting.fulfilled===true) //get all fulfilled waitings for a user\n        for(let i=0;i<waitingsFulfilled.length;i++){\n            waitingsFulFilledMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsFulfilled[i].book_id)) //create an array of those books by comparing to saved books\n        } \n        \n        if (waitingsFulfilled.length < 1){\n             setReviewLeft(true)\n         }\n\n\n\n        if (savedBooks.length > 0){\n            receivedMapped = waitingsFulFilledMapped.map(waiting=>{ //create JSX of books\n                return (<BackEndBookCard book={waiting}/>)\n            })\n        }\n        \n        \n        if (waitingsFulfilled.length > 0){\n            mostRecent = (waitingsFulfilled.sort(function (a, b){ // find most recent received\n                return b.id - a.id\n            })[0])\n            if (Object.keys(mostRecent).length !== 0){ // if theres not most recent book\n                \n                //check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\n                let creationDate = new Date(parseInt(mostRecent.sponsor_date)+60000).getTime()\n                let now = new Date().getTime()\n\n                if (now < creationDate){ // wait period has not passed\n                    displayTimer = true\n                }\n                else\n                {\n                    displayTimer = false\n                    console.log(`setTimeLeft(false)`)\n                    setTimeLeft(false)\n                }\n\n            }\n                foundBook = savedBooks.find(book=>book.id===mostRecent.book_id) // find most recently received book based on most recent waiting\n                if (foundBook){\n                    foundReview = foundBook.reviews.find(review=>review.user.id===user.id) // check if they left a review on it\n                    if (foundReview){\n                        setReviewLeft(true)\n                    }\n                    else{\n                        setReviewLeft(false) //if book was found without a review\n                    }\n                    \n                }\n                else{ // if no book is on received list\n                    setReviewLeft(true)\n                }\n        } \n    }\n    \n    function handleNextClick(){\n        if (waitlistIndex < waitlistMapped.length){\n            if (waitlistMapped.length - waitlistIndex > 8){\n                setWaitlistIndex(waitlistIndex+8)\n            }\n            else{\n            setWaitlistIndex(0)\n            }\n        }\n    }\n\n    if (user){\n        console.log('timeleft:', timeLeft)\n        console.log('reviewleft:', reviewLeft)\n        return(\n        <div className=\"userpage\"> \n\n        <div className=\"userpage-top-half\">\n\n             <div className=\"userpage-eligibility-info\" style={{float:'left'}}>\n                \n                {user.eligible? <h3>Looks like {user.username} is eligible for their next book!</h3> : <h3>Looks like {user.username} needs to wait two weeks or leave a review to be eligible for their next book!</h3>}\n                {/* {reviewLeft === false && mostRecent!== null && (user.waitings.length > 0) ? (<div style={{margin:'auto'}} > <h3 >Please leave a review for</h3> <div style={{margin:'auto'}}><BackEndBookCard book={foundBook} style={{margin:'auto'}}/></div> </div>): null} */}\n            </div>\n\n                <div className=\"userpage-user-info\">\n                    <h3>Profile</h3>\n                    <Image src={user.profile_pic ? user.profile_pic : null} size=\"small\" circular style={{float:'left'}}/>\n                    <div style={{float:'left', marginLeft: '50px'}}>\n                        <h4 style={{display:'inline'}}>Name: </h4>{user.name ? user.name : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Email: </h4>{user.email ?  user.email : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Username: </h4>{user.username ? user.username : null }\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Bio: </h4>{user.bio ? user.bio : null}\n                    </div>\n                    \n                </div>\n                \n\n        </div>\n           \n\n                <h3 className=\"pop\">Waitlist</h3>\n                {waitingsMapped.length > 0 ? \n                    <>\n                        <div className=\"userpage-book-display\">\n                            <Card.Group itemsPerRow={8}>\n                                {waitlistMapped.slice(waitlistIndex, waitlistIndex+8)}  \n                            </Card.Group>\n                        </div>\n                        <Button className=\"next-back-button\"  onClick={handleNextClick}>Next</Button>\n                        {waitlistIndex > 0 ? <Button className=\"next-back-button\"  onClick={()=>setIndex(waitlistIndex-8)}>Back</Button>: null}\n                    </>\n                :null}\n\n                <h3 className=\"pop\">Received</h3>\n                {waitingsFulFilledMapped.length > 0 ? \n                    <>\n                        <div className=\"userpage-book-display\">\n                            <Card.Group itemsPerRow={8}>\n                                {receivedMapped.slice(index, index+8)}  \n                            </Card.Group>\n                        </div>\n                        <Button className=\"next-back-button\"  onClick={()=>setIndex(index+8)}>Next</Button>\n                        {index > 0 ? <Button className=\"next-back-button\"  onClick={()=>setIndex(index-8)}>Back</Button>: null}\n                    </>\n                :null}\n\n\n                <h3 className=\"pop\">Sponsored</h3>\n                {sponsoredMapped.length > 0 ?\n                    <>\n                        <div className=\"userpage-book-display\">\n                            <Card.Group itemsPerRow={8}>\n                                {sponsoredMapped.slice(sponsoredIndex, sponsoredIndex+8)}  \n                            </Card.Group>\n                        </div>\n                        <Button className=\"next-back-button\"  onClick={()=>setSponsoredIndex(sponsoredIndex+8)}>Next</Button>\n                        {sponsoredIndex > 0 ? <Button className=\"next-back-button\"  onClick={()=>setSponsoredIndex(sponsoredIndex-8)}>Back</Button>: null}\n                    </>\n                :null}\n\n            </div>\n        )\n\n    }\n    else{\n        return <>\n        Loading\n        \n        </>\n    }\n}\n\n\n// export default function OtherUserPage({savedBooks}){\n\n//     const [otherUser, setOtherUser] = useState(null)\n\n//     const params = useParams()\n//     let waitingsMapped = []\n//     let waitlistMapped = []\n    \n\n//     useEffect(()=>{\n//         fetch(`${process.env.REACT_APP_API_BASE_URL}/users/${params.id}`)\n//         .then(response => response.json())\n//         .then(data=>setOtherUser(data))  \n//     },[])\n\n\n//     if (otherUser && savedBooks.length > 0){  \n\n//         let waitingsUnfulfilled = otherUser.waitings.filter(waiting=>waiting.fulfilled!==true)\n//         for(let i=0;i<waitingsUnfulfilled.length;i++){\n//         waitingsMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsUnfulfilled[i].book_id))\n//         } \n//         waitlistMapped = waitingsMapped.map(waiting=>{\n//             return (<BackEndBookCard book={waiting}/>)\n//         })\n \n//         return(\n//             <div> \n//                 <img src={otherUser.profile_pic ? otherUser.profile_pic : null}></img>\n//                 <p>name: {otherUser.name ? otherUser.name : null}</p>\n//                 <p>email: {otherUser.email ? otherUser.email : null}</p>\n//                 <p>username: {otherUser.username ? otherUser.username : null }</p>\n//                 <p>bio: {otherUser.bio ? otherUser.bio : null}</p>\n//                 <p>waitlist:</p>\n//                 <ul>{waitingsMapped.length > 0 ? waitlistMapped:null}</ul>\n//             </div>\n//         )\n//     }\n    \n//     else{\n//         return <p>loading</p>\n//     }\n// }\n"]},"metadata":{},"sourceType":"module"}