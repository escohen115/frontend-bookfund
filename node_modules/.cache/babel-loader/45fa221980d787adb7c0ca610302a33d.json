{"ast":null,"code":"var _jsxFileName = \"/Users/simoncohen/Flatiron/Mod5/frontend-bookfund/src/components/pages/UserPage/UserPage.js\",\n    _s = $RefreshSig$();\n\nimport { Button } from 'semantic-ui-react';\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport Timer from './Timer';\nimport BackEndBookCard from '../BookIndex/BackEndBookCard';\nimport { Image, Form } from 'semantic-ui-react';\nimport SponsorList from './SponsorList';\nimport WaitList from \"./WaitList\";\nimport ReceivedList from './ReceivedList';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function UserPage({\n  user,\n  savedBooks,\n  timeLeft,\n  setTimeLeft,\n  reviewLeft,\n  setReviewLeft\n}) {\n  _s();\n\n  let waitingsFulFilledMapped = [];\n  let mostRecent = {};\n  let foundBook = null;\n  let foundReview = null;\n  let waitlistMapped = 0;\n  let displayTimer = false;\n  const [allWaitings, setAllWaitings] = useState([]);\n  const [displayTimerTwo, setDisplayTimerTwo] = useState(true);\n  const [editInfo] = useState(false);\n  const [formState, setFormState] = useState({});\n  useEffect(() => {\n    fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`).then(response => response.json()).then(data => setAllWaitings(data));\n  }, []);\n\n  function handleChange(e) {\n    console.log(e);\n    setFormState({ ...formState,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  function handleImage(e) {\n    e.persist();\n    setFormState({ ...formState,\n      [e.target.name]: e.target.files[0]\n    });\n  }\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    const form = new FormData();\n\n    if (!formState.username) {\n      alert('Please enter a username.');\n    }\n\n    form.append(\"profile_pic\", formState.profile_pic);\n    form.append(\"username\", formState.username);\n    form.append(\"name\", formState.name);\n    form.append(\"bio\", formState.bio);\n    form.append(\"email\", formState.email);\n  }\n\n  if (user) {\n    if (user.waitings.length < 1) {\n      // console.log(`setTimeLeft(false)`)\n      setTimeLeft(false);\n      setReviewLeft(true);\n    }\n\n    let waitingsFulfilled = user.waitings.filter(waiting => waiting.fulfilled === true); //get all fulfilled waitings for a user\n\n    for (let i = 0; i < waitingsFulfilled.length; i++) {\n      waitingsFulFilledMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsFulfilled[i].book_id)); //create an array of those books by comparing to saved books\n    }\n\n    if (waitingsFulfilled.length < 1) {\n      setReviewLeft(true);\n    }\n\n    if (waitingsFulfilled.length > 0) {\n      mostRecent = waitingsFulfilled.sort(function (a, b) {\n        // find most recent received\n        return b.id - a.id;\n      })[0];\n\n      if (Object.keys(mostRecent).length !== 0) {\n        // if theres not most recent book\n        //check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\n        let creationDate = new Date(parseInt(mostRecent.sponsor_date) + 60000).getTime();\n        let now = new Date().getTime();\n\n        if (now < creationDate) {\n          // wait period has not passed\n          displayTimer = true;\n        } else {\n          displayTimer = false;\n          console.log(`setTimeLeft(false)`);\n          setTimeLeft(false);\n        }\n      }\n\n      foundBook = savedBooks.find(book => book.id === mostRecent.book_id); // find most recently received book based on most recent waiting\n\n      if (foundBook) {\n        foundReview = foundBook.reviews.find(review => review.user.id === user.id); // check if they left a review on it\n\n        if (foundReview) {\n          setReviewLeft(true);\n        } else {\n          setReviewLeft(false); //if book was found without a review\n        }\n      } else {\n        // if no book is on received list\n        setReviewLeft(true);\n      }\n    }\n  }\n\n  if (user) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"userpage\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userpage-top-half\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"userpage-eligibility-info\",\n          style: {\n            float: 'left'\n          },\n          children: [displayTimer && displayTimerTwo ? /*#__PURE__*/_jsxDEV(Timer, {\n            mostRecent: mostRecent,\n            timeLeft: timeLeft,\n            setTimeLeft: setTimeLeft,\n            displayTimer: displayTimer,\n            setDisplayTimerTwo: setDisplayTimerTwo,\n            reviewLeft: reviewLeft\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 17\n          }, this) : null, displayTimer === false && reviewLeft === true ? /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Looks like you're eligible for your next book!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 66\n          }, this) : null, reviewLeft === false && mostRecent !== null && user.waitings.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              margin: 'auto'\n            },\n            children: [\" \", /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Please leave a review for\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 137,\n              columnNumber: 125\n            }, this), \" \", /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                margin: 'auto'\n              },\n              children: /*#__PURE__*/_jsxDEV(BackEndBookCard, {\n                book: foundBook,\n                style: {\n                  margin: 'auto'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 190\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 137,\n              columnNumber: 161\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 94\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 14\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"userpage-user-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Profile\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Image, {\n            src: user.profile_pic ? user.profile_pic : null,\n            size: \"small\",\n            circular: true,\n            style: {\n              float: 'left'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 17\n          }, this), editInfo ? null : /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              float: 'left',\n              marginLeft: '50px'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Name: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 25\n            }, this), user.name !== \"undefined\" ? user.name : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Email: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 25\n            }, this), user.email !== \"undefined\" ? user.email : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Username: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 25\n            }, this), user.username !== \"undefined\" ? user.username : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 151,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Bio: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 25\n            }, this), user.bio !== \"undefined\" ? user.bio : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 21\n          }, this), editInfo ? /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              float: 'left',\n              marginLeft: '50px'\n            },\n            children: /*#__PURE__*/_jsxDEV(Form, {\n              onSubmit: e => handleSubmit(e),\n              children: [/*#__PURE__*/_jsxDEV(Form.Field, {\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Name\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 161,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Name\",\n                  name: \"name\",\n                  onChange: e => handleChange(e)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 162,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 160,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Form.Field, {\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Username\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 165,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Username\",\n                  name: \"username\",\n                  onChange: e => handleChange(e)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 166,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 164,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Form.Field, {\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Email\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Email\",\n                  name: \"email\",\n                  onChange: e => handleChange(e)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 170,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 168,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Form.Field, {\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Password\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 173,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Password\",\n                  type: \"password\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 174,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 172,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Form.Field, {\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Bio\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 177,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Bio\",\n                  name: \"bio\",\n                  onChange: e => handleChange(e)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 178,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Form.Input, {\n                type: \"file\",\n                name: \"profile_pic\",\n                fluid: true,\n                label: \"Image Upload\",\n                onChange: e => handleImage(e)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 180,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                type: \"submit\",\n                style: {\n                  float: 'right',\n                  marginBottom: '10px'\n                },\n                children: \"Sign Up\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 22\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 17\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"pop\",\n        children: \"Waitlist\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(WaitList, {\n        waitlistMapped: waitlistMapped,\n        user: user,\n        savedBooks: savedBooks\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"pop\",\n        children: \"Received\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 17\n      }, this), waitingsFulFilledMapped.length > 0 ? /*#__PURE__*/_jsxDEV(ReceivedList, {\n        waitingsFulFilledMapped: waitingsFulFilledMapped,\n        savedBooks: savedBooks,\n        waitlistMapped: waitlistMapped\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 21\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"pop\",\n        children: \"Sponsored\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(SponsorList, {\n        allWaitings: allWaitings,\n        savedBooks: savedBooks,\n        user: user\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 9\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\"Error. Please try again\", /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/bookindex\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n}\n\n_s(UserPage, \"Uq056j9EvH9TBC9/K+ELLWDMy/Q=\");\n\n_c = UserPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserPage\");","map":{"version":3,"sources":["/Users/simoncohen/Flatiron/Mod5/frontend-bookfund/src/components/pages/UserPage/UserPage.js"],"names":["Button","React","useState","useEffect","Redirect","Timer","BackEndBookCard","Image","Form","SponsorList","WaitList","ReceivedList","UserPage","user","savedBooks","timeLeft","setTimeLeft","reviewLeft","setReviewLeft","waitingsFulFilledMapped","mostRecent","foundBook","foundReview","waitlistMapped","displayTimer","allWaitings","setAllWaitings","displayTimerTwo","setDisplayTimerTwo","editInfo","formState","setFormState","fetch","process","env","REACT_APP_API_BASE_URL","then","response","json","data","handleChange","e","console","log","target","name","value","handleImage","persist","files","handleSubmit","preventDefault","form","FormData","username","alert","append","profile_pic","bio","email","waitings","length","waitingsFulfilled","filter","waiting","fulfilled","i","push","find","saved_book","id","book_id","sort","a","b","Object","keys","creationDate","Date","parseInt","sponsor_date","getTime","now","book","reviews","review","float","margin","marginLeft","display","marginBottom"],"mappings":"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","sourcesContent":["import { Button } from 'semantic-ui-react'\nimport React, { useState, useEffect } from \"react\"\nimport { Redirect } from \"react-router-dom\";\nimport Timer from './Timer'\nimport BackEndBookCard from '../BookIndex/BackEndBookCard'\nimport { Image, Form } from 'semantic-ui-react'\nimport SponsorList from './SponsorList'\nimport WaitList from \"./WaitList\";\nimport ReceivedList from './ReceivedList'\n\nexport default function UserPage({user, savedBooks, timeLeft, setTimeLeft, reviewLeft, setReviewLeft}){\n\n    let waitingsFulFilledMapped = []\n    let mostRecent = {}\n    let foundBook = null\n    let foundReview = null\n    let waitlistMapped = 0\n    let displayTimer = false\n    \n    const [allWaitings, setAllWaitings] = useState([])\n    const [displayTimerTwo, setDisplayTimerTwo] = useState(true)\n    const [editInfo] = useState(false)\n    const [formState, setFormState] = useState({})\n\n    \n    useEffect(()=>{\n    fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`)\n    .then(response=>response.json())\n    .then(data=>setAllWaitings(data))\n    },[])\n\n    function handleChange(e){\n        console.log(e)\n        setFormState({\n            ...formState,\n            [e.target.name]: e.target.value\n        })   \n    }\n\n    function handleImage (e){\n        e.persist()\n        setFormState({\n            ...formState,\n            [e.target.name]: e.target.files[0]\n        })\n    }\n\n    function handleSubmit(e){\n        e.preventDefault()\n        const form = new FormData()\n\n        if (!(formState.username)){\n            alert('Please enter a username.')\n        }\n\n        form.append(\"profile_pic\", formState.profile_pic)\n        form.append(\"username\", formState.username)\n        form.append(\"name\", formState.name)\n        form.append(\"bio\", formState.bio)\n        form.append(\"email\", formState.email)\n    \n    }\n    \n    if (user){ \n        if (user.waitings.length < 1){\n            // console.log(`setTimeLeft(false)`)\n            setTimeLeft(false)\n            setReviewLeft(true)\n        }\n\n        let waitingsFulfilled = user.waitings.filter(waiting=>waiting.fulfilled===true) //get all fulfilled waitings for a user\n        for(let i = 0;i < waitingsFulfilled.length; i++){\n            waitingsFulFilledMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsFulfilled[i].book_id)) //create an array of those books by comparing to saved books\n        } \n        \n        if (waitingsFulfilled.length < 1){\n             setReviewLeft(true)\n        }\n        \n        if (waitingsFulfilled.length > 0){\n            mostRecent = (waitingsFulfilled.sort(function (a, b){ // find most recent received\n                return b.id - a.id\n            })[0])\n            if (Object.keys(mostRecent).length !== 0){ // if theres not most recent book\n                //check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\n                let creationDate = new Date(parseInt(mostRecent.sponsor_date)+60000).getTime()\n                let now = new Date().getTime()\n\n                if (now < creationDate){ // wait period has not passed\n                    displayTimer = true\n                }\n                else\n                {\n                    displayTimer = false\n                    console.log(`setTimeLeft(false)`)\n                    setTimeLeft(false)\n                }\n\n            }\n                foundBook = savedBooks.find(book=>book.id===mostRecent.book_id) // find most recently received book based on most recent waiting\n                if (foundBook){\n                    foundReview = foundBook.reviews.find(review=>review.user.id===user.id) // check if they left a review on it\n                    if (foundReview){\n                        setReviewLeft(true)\n                    }\n                    else{\n                        setReviewLeft(false) //if book was found without a review\n                    }\n                    \n                }\n                else{ // if no book is on received list\n                    setReviewLeft(true)\n                }\n        }\n         \n\n    }\n    if (user){\n\n        return(\n        <div className=\"userpage\"> \n\n        <div className=\"userpage-top-half\">\n\n             <div className=\"userpage-eligibility-info\" style={{float:'left'}}>\n                { displayTimer && displayTimerTwo ?\n                <Timer \n                    mostRecent={mostRecent}\n                    timeLeft={timeLeft} \n                    setTimeLeft={setTimeLeft}\n                    displayTimer={displayTimer}\n                    setDisplayTimerTwo={setDisplayTimerTwo}\n                    reviewLeft={reviewLeft}\n                />\n            : null}\n                {displayTimer === false && reviewLeft === true ? <h3>Looks like you're eligible for your next book!</h3> : null}\n                {reviewLeft === false && mostRecent!== null && (user.waitings.length > 0) ? (<div style={{margin:'auto'}} > <h3 >Please leave a review for</h3> <div style={{margin:'auto'}}><BackEndBookCard book={foundBook} style={{margin:'auto'}}/></div> </div>): null}\n            </div>\n            <div className=\"userpage-user-info\"  >\n                <h3>Profile</h3>\n                <Image src={user.profile_pic ? user.profile_pic : null} size=\"small\" circular style={{float:'left'}}/>\n                    {editInfo ? null :\n                    <div style={{float:'left', marginLeft: '50px'}}>\n                        <h4 style={{display:'inline'}}>Name: </h4>{user.name !== \"undefined\"? user.name : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Email: </h4>{user.email !== \"undefined\" ?  user.email : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Username: </h4>{user.username !== \"undefined\" ? user.username : null }\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Bio: </h4>{user.bio !== \"undefined\" ? user.bio : null}\n                    </div>\n                }\n\n                {editInfo ? \n                <div style={{float:'left', marginLeft: '50px'}}>\n                     <Form onSubmit={(e)=>handleSubmit(e)}>\n                        <Form.Field>\n                            <label>Name</label>\n                            <input placeholder='Name' name=\"name\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Field>\n                            <label>Username</label>\n                            <input placeholder='Username' name=\"username\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Field>\n                            <label>Email</label>\n                            <input placeholder='Email' name=\"email\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Field>\n                            <label>Password</label>\n                            <input placeholder='Password' type=\"password\" />\n                        </Form.Field>\n                        <Form.Field >\n                            <label>Bio</label>\n                            <input placeholder='Bio' name=\"bio\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Input \n                        type=\"file\" \n                        name=\"profile_pic\" \n                        fluid label='Image Upload' \n                        onChange={(e)=>handleImage(e)} \n                        />\n                    <Button type='submit' style={{float:'right', marginBottom: '10px'}}>Sign Up</Button>\n                    </Form>   \n                </div>\n                    \n                : null}\n\n                {/* <Button style={{float:'right', marginRight: '50px'}} onClick={()=>setEditInfo(!editInfo)}> Edit Profile Info </Button> */}\n            \n            </div>\n\n                \n\n\n\n\n\n                    \n        \n        \n        </div>\n                <h3 className=\"pop\">Waitlist</h3>\n        \n                <WaitList\n                waitlistMapped={waitlistMapped}\n                user={user}\n                savedBooks={savedBooks}/>\n\n\n                <h3 className=\"pop\">Received</h3>\n                {waitingsFulFilledMapped.length > 0 ? \n                    <ReceivedList\n                    waitingsFulFilledMapped={waitingsFulFilledMapped}\n                    savedBooks={savedBooks}\n                    waitlistMapped={waitlistMapped}/>\n                :null}\n\n\n                <h3 className=\"pop\">Sponsored</h3>\n                <SponsorList\n                allWaitings={allWaitings}\n                savedBooks={savedBooks}\n                user={user}/>\n            </div>\n        )\n\n    }\n    else{\n        return <>\n        Error. Please try again\n            <Redirect to =\"/bookindex\"/>\n        </>\n    }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}