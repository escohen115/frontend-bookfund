{"ast":null,"code":"var _jsxFileName = \"/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/src/components/pages/UserPage/UserPage.js\",\n    _s = $RefreshSig$();\n\nimport { Button } from 'semantic-ui-react';\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport Timer from './Timer';\nimport BackEndBookCard from '../BookIndex/BackEndBookCard';\nimport { Image } from 'semantic-ui-react';\nimport SponsorList from './SponsorList';\nimport WaitList from \"./WaitList\";\nimport ReceivedList from './ReceivedList';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function UserPage({\n  user,\n  savedBooks,\n  timeLeft,\n  setTimeLeft,\n  reviewLeft,\n  setReviewLeft\n}) {\n  _s();\n\n  let waitingsFulFilledMapped = [];\n  let mostRecent = {};\n  let foundBook = null;\n  let foundReview = null;\n  let waitlistMapped = 0;\n  let displayTimer = false;\n  const [allWaitings, setAllWaitings] = useState([]);\n  const [displayTimerTwo, setDisplayTimerTwo] = useState(true);\n  const [editInfo, setEditInfo] = useState(false);\n  useEffect(() => {\n    fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`).then(response => response.json()).then(data => setAllWaitings(data));\n  }, []);\n\n  if (user) {\n    // if user has no waitings, they're eligible\n    if (user.waitings.length < 1) {\n      console.log(`setTimeLeft(false)`);\n      setTimeLeft(false);\n      setReviewLeft(true);\n    }\n\n    let waitingsFulfilled = user.waitings.filter(waiting => waiting.fulfilled === true); //get all fulfilled waitings for a user\n\n    for (let i = 0; i < waitingsFulfilled.length; i++) {\n      waitingsFulFilledMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsFulfilled[i].book_id)); //create an array of those books by comparing to saved books\n    }\n\n    if (waitingsFulfilled.length < 1) {\n      setReviewLeft(true);\n    }\n\n    if (waitingsFulfilled.length > 0) {\n      mostRecent = waitingsFulfilled.sort(function (a, b) {\n        // find most recent received\n        return b.id - a.id;\n      })[0];\n\n      if (Object.keys(mostRecent).length !== 0) {\n        // if theres not most recent book\n        //check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\n        let creationDate = new Date(parseInt(mostRecent.sponsor_date) + 60000).getTime();\n        let now = new Date().getTime();\n\n        if (now < creationDate) {\n          // wait period has not passed\n          displayTimer = true;\n        } else {\n          displayTimer = false;\n          console.log(`setTimeLeft(false)`);\n          setTimeLeft(false);\n        }\n      }\n\n      foundBook = savedBooks.find(book => book.id === mostRecent.book_id); // find most recently received book based on most recent waiting\n\n      if (foundBook) {\n        foundReview = foundBook.reviews.find(review => review.user.id === user.id); // check if they left a review on it\n\n        if (foundReview) {\n          setReviewLeft(true);\n        } else {\n          setReviewLeft(false); //if book was found without a review\n        }\n      } else {\n        // if no book is on received list\n        setReviewLeft(true);\n      }\n    }\n  }\n\n  if (user) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"userpage\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userpage-top-half\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"userpage-eligibility-info\",\n          style: {\n            float: 'left'\n          },\n          children: [displayTimer && displayTimerTwo ? /*#__PURE__*/_jsxDEV(Timer, {\n            mostRecent: mostRecent,\n            timeLeft: timeLeft,\n            setTimeLeft: setTimeLeft,\n            displayTimer: displayTimer,\n            setDisplayTimerTwo: setDisplayTimerTwo,\n            reviewLeft: reviewLeft\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 17\n          }, this) : null, displayTimer === false && reviewLeft === true ? /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Looks like you're eligible for your next book!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 66\n          }, this) : null, reviewLeft === false && mostRecent !== null && user.waitings.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              margin: 'auto'\n            },\n            children: [\" \", /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Please leave a review for\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 125\n            }, this), \" \", /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                margin: 'auto'\n              },\n              children: /*#__PURE__*/_jsxDEV(BackEndBookCard, {\n                book: foundBook,\n                style: {\n                  margin: 'auto'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 104,\n                columnNumber: 190\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 161\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 94\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 14\n        }, this), editInfo ? null : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"userpage-user-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Profile\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Image, {\n            src: user.profile_pic ? user.profile_pic : null,\n            size: \"small\",\n            circular: true,\n            style: {\n              float: 'left'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              float: 'left',\n              marginLeft: '50px'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Name: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 25\n            }, this), user.name !== \"undefined\" ? user.name : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 112,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Email: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 25\n            }, this), user.email !== \"undefined\" ? user.email : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Username: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 25\n            }, this), user.username !== \"undefined\" ? user.username : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                display: 'inline'\n              },\n              children: \"Bio: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 120,\n              columnNumber: 25\n            }, this), user.bio !== \"undefined\" ? user.bio : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            style: {\n              float: 'right',\n              marginRight: '50px'\n            },\n            onClick: () => set,\n            children: \" Edit Profile Info \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"pop\",\n        children: \"Waitlist\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(WaitList, {\n        waitlistMapped: waitlistMapped,\n        user: user,\n        savedBooks: savedBooks\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"pop\",\n        children: \"Received\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }, this), waitingsFulFilledMapped.length > 0 ? /*#__PURE__*/_jsxDEV(ReceivedList, {\n        waitingsFulFilledMapped: waitingsFulFilledMapped,\n        savedBooks: savedBooks,\n        waitlistMapped: waitlistMapped\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 21\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"pop\",\n        children: \"Sponsored\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(SponsorList, {\n        allWaitings: allWaitings,\n        savedBooks: savedBooks,\n        user: user\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\"Error. Please try again\", /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/bookindex\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n}\n\n_s(UserPage, \"DsCU7uKGGQUzJvXKRBDTNP7j05Q=\");\n\n_c = UserPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserPage\");","map":{"version":3,"sources":["/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/src/components/pages/UserPage/UserPage.js"],"names":["Button","React","useState","useEffect","Redirect","Timer","BackEndBookCard","Image","SponsorList","WaitList","ReceivedList","UserPage","user","savedBooks","timeLeft","setTimeLeft","reviewLeft","setReviewLeft","waitingsFulFilledMapped","mostRecent","foundBook","foundReview","waitlistMapped","displayTimer","allWaitings","setAllWaitings","displayTimerTwo","setDisplayTimerTwo","editInfo","setEditInfo","fetch","process","env","REACT_APP_API_BASE_URL","then","response","json","data","waitings","length","console","log","waitingsFulfilled","filter","waiting","fulfilled","i","push","find","saved_book","id","book_id","sort","a","b","Object","keys","creationDate","Date","parseInt","sponsor_date","getTime","now","book","reviews","review","float","margin","profile_pic","marginLeft","display","name","email","username","bio","marginRight","set"],"mappings":"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","sourcesContent":["import { Button } from 'semantic-ui-react'\nimport React, { useState, useEffect } from \"react\"\nimport { Redirect } from \"react-router-dom\";\nimport Timer from './Timer'\nimport BackEndBookCard from '../BookIndex/BackEndBookCard'\nimport { Image } from 'semantic-ui-react'\nimport SponsorList from './SponsorList'\nimport WaitList from \"./WaitList\";\nimport ReceivedList from './ReceivedList'\n\nexport default function UserPage({user, savedBooks, timeLeft, setTimeLeft, reviewLeft, setReviewLeft}){\n\n    let waitingsFulFilledMapped = []\n    let mostRecent = {}\n    let foundBook = null\n    let foundReview = null\n    let waitlistMapped = 0\n    let displayTimer = false\n    \n    const [allWaitings, setAllWaitings] = useState([])\n    const [displayTimerTwo, setDisplayTimerTwo] = useState(true)\n    const [editInfo, setEditInfo] = useState(false)\n    \n    useEffect(()=>{\n    fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`)\n    .then(response=>response.json())\n    .then(data=>setAllWaitings(data))\n    },[])\n    \n    if (user){ \n        // if user has no waitings, they're eligible\n        if (user.waitings.length < 1){\n            console.log(`setTimeLeft(false)`)\n             setTimeLeft(false)\n             setReviewLeft(true)\n        }\n\n        let waitingsFulfilled = user.waitings.filter(waiting=>waiting.fulfilled===true) //get all fulfilled waitings for a user\n        for(let i = 0;i < waitingsFulfilled.length; i++){\n            waitingsFulFilledMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsFulfilled[i].book_id)) //create an array of those books by comparing to saved books\n        } \n        \n        if (waitingsFulfilled.length < 1){\n             setReviewLeft(true)\n        }\n        \n        if (waitingsFulfilled.length > 0){\n            mostRecent = (waitingsFulfilled.sort(function (a, b){ // find most recent received\n                return b.id - a.id\n            })[0])\n            if (Object.keys(mostRecent).length !== 0){ // if theres not most recent book\n                //check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\n                let creationDate = new Date(parseInt(mostRecent.sponsor_date)+60000).getTime()\n                let now = new Date().getTime()\n\n                if (now < creationDate){ // wait period has not passed\n                    displayTimer = true\n                }\n                else\n                {\n                    displayTimer = false\n                    console.log(`setTimeLeft(false)`)\n                    setTimeLeft(false)\n                }\n\n            }\n                foundBook = savedBooks.find(book=>book.id===mostRecent.book_id) // find most recently received book based on most recent waiting\n                if (foundBook){\n                    foundReview = foundBook.reviews.find(review=>review.user.id===user.id) // check if they left a review on it\n                    if (foundReview){\n                        setReviewLeft(true)\n                    }\n                    else{\n                        setReviewLeft(false) //if book was found without a review\n                    }\n                    \n                }\n                else{ // if no book is on received list\n                    setReviewLeft(true)\n                }\n        }\n         \n\n    }\n    if (user){\n\n        return(\n        <div className=\"userpage\"> \n\n        <div className=\"userpage-top-half\">\n\n             <div className=\"userpage-eligibility-info\" style={{float:'left'}}>\n                { displayTimer && displayTimerTwo ?\n                <Timer \n                    mostRecent={mostRecent}\n                    timeLeft={timeLeft} \n                    setTimeLeft={setTimeLeft}\n                    displayTimer={displayTimer}\n                    setDisplayTimerTwo={setDisplayTimerTwo}\n                    reviewLeft={reviewLeft}\n                />\n            : null}\n                {displayTimer === false && reviewLeft === true ? <h3>Looks like you're eligible for your next book!</h3> : null}\n                {reviewLeft === false && mostRecent!== null && (user.waitings.length > 0) ? (<div style={{margin:'auto'}} > <h3 >Please leave a review for</h3> <div style={{margin:'auto'}}><BackEndBookCard book={foundBook} style={{margin:'auto'}}/></div> </div>): null}\n            </div>\n                    {editInfo ? null :\n                        <div className=\"userpage-user-info\"  >\n                    <h3>Profile</h3>\n                    <Image src={user.profile_pic ? user.profile_pic : null} size=\"small\" circular style={{float:'left'}}/>\n                    <div style={{float:'left', marginLeft: '50px'}}>\n                        <h4 style={{display:'inline'}}>Name: </h4>{user.name !== \"undefined\"? user.name : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Email: </h4>{user.email !== \"undefined\" ?  user.email : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Username: </h4>{user.username !== \"undefined\" ? user.username : null }\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Bio: </h4>{user.bio !== \"undefined\" ? user.bio : null}\n                    </div>\n\n                    <Button style={{float:'right', marginRight: '50px'}} onClick={()=>set}> Edit Profile Info </Button>\n                    \n                    \n                </div>\n                    }\n                \n                    \n        \n        \n        </div>\n                <h3 className=\"pop\">Waitlist</h3>\n        \n                <WaitList\n                waitlistMapped={waitlistMapped}\n                user={user}\n                savedBooks={savedBooks}/>\n\n\n                <h3 className=\"pop\">Received</h3>\n                {waitingsFulFilledMapped.length > 0 ? \n                    <ReceivedList\n                    waitingsFulFilledMapped={waitingsFulFilledMapped}\n                    savedBooks={savedBooks}\n                    waitlistMapped={waitlistMapped}/>\n                :null}\n\n\n                <h3 className=\"pop\">Sponsored</h3>\n                <SponsorList\n                allWaitings={allWaitings}\n                savedBooks={savedBooks}\n                user={user}/>\n            </div>\n        )\n\n    }\n    else{\n        return <>\n        Error. Please try again\n            <Redirect to =\"/bookindex\"/>\n        </>\n    }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}