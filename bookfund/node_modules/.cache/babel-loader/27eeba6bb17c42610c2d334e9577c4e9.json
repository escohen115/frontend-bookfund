{"ast":null,"code":"import _defineProperty from\"/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button}from'semantic-ui-react';import React,{useState,useEffect}from\"react\";import{Redirect}from\"react-router-dom\";import Timer from'./Timer';import BackEndBookCard from'../BookIndex/BackEndBookCard';import{Image,Form}from'semantic-ui-react';import SponsorList from'./SponsorList';import WaitList from\"./WaitList\";import ReceivedList from'./ReceivedList';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function UserPage(_ref){var user=_ref.user,savedBooks=_ref.savedBooks,timeLeft=_ref.timeLeft,setTimeLeft=_ref.setTimeLeft,reviewLeft=_ref.reviewLeft,setReviewLeft=_ref.setReviewLeft;var waitingsFulFilledMapped=[];var mostRecent={};var foundBook=null;var foundReview=null;var waitlistMapped=0;var displayTimer=false;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),allWaitings=_useState2[0],setAllWaitings=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),displayTimerTwo=_useState4[0],setDisplayTimerTwo=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,1),editInfo=_useState6[0];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),formState=_useState8[0],setFormState=_useState8[1];useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/waitings\")).then(function(response){return response.json();}).then(function(data){return setAllWaitings(data);});},[]);function handleChange(e){console.log(e);setFormState(_objectSpread(_objectSpread({},formState),{},_defineProperty({},e.target.name,e.target.value)));}function handleImage(e){e.persist();setFormState(_objectSpread(_objectSpread({},formState),{},_defineProperty({},e.target.name,e.target.files[0])));}function handleSubmit(e){e.preventDefault();var form=new FormData();if(!formState.username){alert('Please enter a username.');}form.append(\"profile_pic\",formState.profile_pic);form.append(\"username\",formState.username);form.append(\"name\",formState.name);form.append(\"bio\",formState.bio);form.append(\"email\",formState.email);}if(user){(function(){if(user.waitings.length<1){// console.log(`setTimeLeft(false)`)\nsetTimeLeft(false);setReviewLeft(true);}var waitingsFulfilled=user.waitings.filter(function(waiting){return waiting.fulfilled===true;});//get all fulfilled waitings for a user\nvar _loop=function _loop(i){waitingsFulFilledMapped.push(savedBooks.find(function(saved_book){return saved_book.id===waitingsFulfilled[i].book_id;}));//create an array of those books by comparing to saved books\n};for(var i=0;i<waitingsFulfilled.length;i++){_loop(i);}if(waitingsFulfilled.length<1){setReviewLeft(true);}if(waitingsFulfilled.length>0){mostRecent=waitingsFulfilled.sort(function(a,b){// find most recent received\nreturn b.id-a.id;})[0];if(Object.keys(mostRecent).length!==0){// if theres not most recent book\n//check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\nvar creationDate=new Date(parseInt(mostRecent.sponsor_date)+60000).getTime();var now=new Date().getTime();if(now<creationDate){// wait period has not passed\ndisplayTimer=true;}else{displayTimer=false;console.log(\"setTimeLeft(false)\");setTimeLeft(false);}}foundBook=savedBooks.find(function(book){return book.id===mostRecent.book_id;});// find most recently received book based on most recent waiting\nif(foundBook){foundReview=foundBook.reviews.find(function(review){return review.user.id===user.id;});// check if they left a review on it\nif(foundReview){setReviewLeft(true);}else{setReviewLeft(false);//if book was found without a review\n}}else{// if no book is on received list\nsetReviewLeft(true);}}})();}if(user){return/*#__PURE__*/_jsxs(\"div\",{className:\"userpage\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"userpage-top-half\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"userpage-eligibility-info\",style:{float:'left'},children:[displayTimer&&displayTimerTwo?/*#__PURE__*/_jsx(Timer,{mostRecent:mostRecent,timeLeft:timeLeft,setTimeLeft:setTimeLeft,displayTimer:displayTimer,setDisplayTimerTwo:setDisplayTimerTwo,reviewLeft:reviewLeft}):null,displayTimer===false&&reviewLeft===true?/*#__PURE__*/_jsx(\"h3\",{children:\"Looks like you're eligible for your next book!\"}):null,reviewLeft===false&&mostRecent!==null&&user.waitings.length>0?/*#__PURE__*/_jsxs(\"div\",{style:{margin:'auto'},children:[\" \",/*#__PURE__*/_jsx(\"h3\",{children:\"Please leave a review for\"}),\" \",/*#__PURE__*/_jsx(\"div\",{style:{margin:'auto'},children:/*#__PURE__*/_jsx(BackEndBookCard,{book:foundBook,style:{margin:'auto'}})}),\" \"]}):null]}),/*#__PURE__*/_jsxs(\"div\",{className:\"userpage-user-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Profile\"}),/*#__PURE__*/_jsx(Image,{src:user.profile_pic?user.profile_pic:null,size:\"small\",circular:true,style:{float:'left'}}),editInfo?null:/*#__PURE__*/_jsxs(\"div\",{style:{float:'left',marginLeft:'50px'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Name: \"}),user.name!==\"undefined\"?user.name:null,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Email: \"}),user.email!==\"undefined\"?user.email:null,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Username: \"}),user.username!==\"undefined\"?user.username:null,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h4\",{style:{display:'inline'},children:\"Bio: \"}),user.bio!==\"undefined\"?user.bio:null]}),editInfo?/*#__PURE__*/_jsx(\"div\",{style:{float:'left',marginLeft:'50px'},children:/*#__PURE__*/_jsxs(Form,{onSubmit:function onSubmit(e){return handleSubmit(e);},children:[/*#__PURE__*/_jsxs(Form.Field,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Name\",name:\"name\",onChange:function onChange(e){return handleChange(e);}})]}),/*#__PURE__*/_jsxs(Form.Field,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Username\",name:\"username\",onChange:function onChange(e){return handleChange(e);}})]}),/*#__PURE__*/_jsxs(Form.Field,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Email\",name:\"email\",onChange:function onChange(e){return handleChange(e);}})]}),/*#__PURE__*/_jsxs(Form.Field,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Password\",type:\"password\"})]}),/*#__PURE__*/_jsxs(Form.Field,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Bio\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Bio\",name:\"bio\",onChange:function onChange(e){return handleChange(e);}})]}),/*#__PURE__*/_jsx(Form.Input,{type:\"file\",name:\"profile_pic\",fluid:true,label:\"Image Upload\",onChange:function onChange(e){return handleImage(e);}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",style:{float:'right',marginBottom:'10px'},children:\"Sign Up\"})]})}):null]})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"pop\",children:\"Waitlist\"}),/*#__PURE__*/_jsx(WaitList,{waitlistMapped:waitlistMapped,user:user,savedBooks:savedBooks}),/*#__PURE__*/_jsx(\"h3\",{className:\"pop\",children:\"Received\"}),waitingsFulFilledMapped.length>0?/*#__PURE__*/_jsx(ReceivedList,{waitingsFulFilledMapped:waitingsFulFilledMapped,savedBooks:savedBooks,waitlistMapped:waitlistMapped}):null,/*#__PURE__*/_jsx(\"h3\",{className:\"pop\",children:\"Sponsored\"}),/*#__PURE__*/_jsx(SponsorList,{allWaitings:allWaitings,savedBooks:savedBooks,user:user})]});}else{return/*#__PURE__*/_jsxs(_Fragment,{children:[\"Error. Please try again\",/*#__PURE__*/_jsx(Redirect,{to:\"/bookindex\"})]});}}","map":{"version":3,"sources":["/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/src/components/pages/UserPage/UserPage.js"],"names":["Button","React","useState","useEffect","Redirect","Timer","BackEndBookCard","Image","Form","SponsorList","WaitList","ReceivedList","UserPage","user","savedBooks","timeLeft","setTimeLeft","reviewLeft","setReviewLeft","waitingsFulFilledMapped","mostRecent","foundBook","foundReview","waitlistMapped","displayTimer","allWaitings","setAllWaitings","displayTimerTwo","setDisplayTimerTwo","editInfo","formState","setFormState","fetch","process","env","REACT_APP_API_BASE_URL","then","response","json","data","handleChange","e","console","log","target","name","value","handleImage","persist","files","handleSubmit","preventDefault","form","FormData","username","alert","append","profile_pic","bio","email","waitings","length","waitingsFulfilled","filter","waiting","fulfilled","i","push","find","saved_book","id","book_id","sort","a","b","Object","keys","creationDate","Date","parseInt","sponsor_date","getTime","now","book","reviews","review","float","margin","marginLeft","display","marginBottom"],"mappings":"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","sourcesContent":["import { Button } from 'semantic-ui-react'\nimport React, { useState, useEffect } from \"react\"\nimport { Redirect } from \"react-router-dom\";\nimport Timer from './Timer'\nimport BackEndBookCard from '../BookIndex/BackEndBookCard'\nimport { Image, Form } from 'semantic-ui-react'\nimport SponsorList from './SponsorList'\nimport WaitList from \"./WaitList\";\nimport ReceivedList from './ReceivedList'\n\nexport default function UserPage({user, savedBooks, timeLeft, setTimeLeft, reviewLeft, setReviewLeft}){\n\n    let waitingsFulFilledMapped = []\n    let mostRecent = {}\n    let foundBook = null\n    let foundReview = null\n    let waitlistMapped = 0\n    let displayTimer = false\n    \n    const [allWaitings, setAllWaitings] = useState([])\n    const [displayTimerTwo, setDisplayTimerTwo] = useState(true)\n    const [editInfo] = useState(false)\n    const [formState, setFormState] = useState({})\n\n    \n    useEffect(()=>{\n    fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`)\n    .then(response=>response.json())\n    .then(data=>setAllWaitings(data))\n    },[])\n\n    function handleChange(e){\n        console.log(e)\n        setFormState({\n            ...formState,\n            [e.target.name]: e.target.value\n        })   \n    }\n\n    function handleImage (e){\n        e.persist()\n        setFormState({\n            ...formState,\n            [e.target.name]: e.target.files[0]\n        })\n    }\n\n    function handleSubmit(e){\n        e.preventDefault()\n        const form = new FormData()\n\n        if (!(formState.username)){\n            alert('Please enter a username.')\n        }\n\n        form.append(\"profile_pic\", formState.profile_pic)\n        form.append(\"username\", formState.username)\n        form.append(\"name\", formState.name)\n        form.append(\"bio\", formState.bio)\n        form.append(\"email\", formState.email)\n    \n    }\n    \n    if (user){ \n        if (user.waitings.length < 1){\n            // console.log(`setTimeLeft(false)`)\n            setTimeLeft(false)\n            setReviewLeft(true)\n        }\n\n        let waitingsFulfilled = user.waitings.filter(waiting=>waiting.fulfilled===true) //get all fulfilled waitings for a user\n        for(let i = 0;i < waitingsFulfilled.length; i++){\n            waitingsFulFilledMapped.push(savedBooks.find(saved_book => saved_book.id === waitingsFulfilled[i].book_id)) //create an array of those books by comparing to saved books\n        } \n        \n        if (waitingsFulfilled.length < 1){\n             setReviewLeft(true)\n        }\n        \n        if (waitingsFulfilled.length > 0){\n            mostRecent = (waitingsFulfilled.sort(function (a, b){ // find most recent received\n                return b.id - a.id\n            })[0])\n            if (Object.keys(mostRecent).length !== 0){ // if theres not most recent book\n                //check mostRecent.waiting date. if no time left between creation and future deadline, setTimeLeft(false), and vice versa\n                let creationDate = new Date(parseInt(mostRecent.sponsor_date)+60000).getTime()\n                let now = new Date().getTime()\n\n                if (now < creationDate){ // wait period has not passed\n                    displayTimer = true\n                }\n                else\n                {\n                    displayTimer = false\n                    console.log(`setTimeLeft(false)`)\n                    setTimeLeft(false)\n                }\n\n            }\n                foundBook = savedBooks.find(book=>book.id===mostRecent.book_id) // find most recently received book based on most recent waiting\n                if (foundBook){\n                    foundReview = foundBook.reviews.find(review=>review.user.id===user.id) // check if they left a review on it\n                    if (foundReview){\n                        setReviewLeft(true)\n                    }\n                    else{\n                        setReviewLeft(false) //if book was found without a review\n                    }\n                    \n                }\n                else{ // if no book is on received list\n                    setReviewLeft(true)\n                }\n        }\n         \n\n    }\n    if (user){\n\n        return(\n        <div className=\"userpage\"> \n\n        <div className=\"userpage-top-half\">\n\n             <div className=\"userpage-eligibility-info\" style={{float:'left'}}>\n                { displayTimer && displayTimerTwo ?\n                <Timer \n                    mostRecent={mostRecent}\n                    timeLeft={timeLeft} \n                    setTimeLeft={setTimeLeft}\n                    displayTimer={displayTimer}\n                    setDisplayTimerTwo={setDisplayTimerTwo}\n                    reviewLeft={reviewLeft}\n                />\n            : null}\n                {displayTimer === false && reviewLeft === true ? <h3>Looks like you're eligible for your next book!</h3> : null}\n                {reviewLeft === false && mostRecent!== null && (user.waitings.length > 0) ? (<div style={{margin:'auto'}} > <h3 >Please leave a review for</h3> <div style={{margin:'auto'}}><BackEndBookCard book={foundBook} style={{margin:'auto'}}/></div> </div>): null}\n            </div>\n            <div className=\"userpage-user-info\"  >\n                <h3>Profile</h3>\n                <Image src={user.profile_pic ? user.profile_pic : null} size=\"small\" circular style={{float:'left'}}/>\n                    {editInfo ? null :\n                    <div style={{float:'left', marginLeft: '50px'}}>\n                        <h4 style={{display:'inline'}}>Name: </h4>{user.name !== \"undefined\"? user.name : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Email: </h4>{user.email !== \"undefined\" ?  user.email : null}\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Username: </h4>{user.username !== \"undefined\" ? user.username : null }\n                        <br></br>\n                        <br></br>\n                        <h4 style={{display:'inline'}}>Bio: </h4>{user.bio !== \"undefined\" ? user.bio : null}\n                    </div>\n                }\n\n                {editInfo ? \n                <div style={{float:'left', marginLeft: '50px'}}>\n                     <Form onSubmit={(e)=>handleSubmit(e)}>\n                        <Form.Field>\n                            <label>Name</label>\n                            <input placeholder='Name' name=\"name\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Field>\n                            <label>Username</label>\n                            <input placeholder='Username' name=\"username\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Field>\n                            <label>Email</label>\n                            <input placeholder='Email' name=\"email\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Field>\n                            <label>Password</label>\n                            <input placeholder='Password' type=\"password\" />\n                        </Form.Field>\n                        <Form.Field >\n                            <label>Bio</label>\n                            <input placeholder='Bio' name=\"bio\" onChange={(e)=>handleChange(e)}/>\n                        </Form.Field>\n                        <Form.Input \n                        type=\"file\" \n                        name=\"profile_pic\" \n                        fluid label='Image Upload' \n                        onChange={(e)=>handleImage(e)} \n                        />\n                    <Button type='submit' style={{float:'right', marginBottom: '10px'}}>Sign Up</Button>\n                    </Form>   \n                </div>\n                    \n                : null}\n\n                {/* <Button style={{float:'right', marginRight: '50px'}} onClick={()=>setEditInfo(!editInfo)}> Edit Profile Info </Button> */}\n            \n            </div>\n\n                \n\n\n\n\n\n                    \n        \n        \n        </div>\n                <h3 className=\"pop\">Waitlist</h3>\n        \n                <WaitList\n                waitlistMapped={waitlistMapped}\n                user={user}\n                savedBooks={savedBooks}/>\n\n\n                <h3 className=\"pop\">Received</h3>\n                {waitingsFulFilledMapped.length > 0 ? \n                    <ReceivedList\n                    waitingsFulFilledMapped={waitingsFulFilledMapped}\n                    savedBooks={savedBooks}\n                    waitlistMapped={waitlistMapped}/>\n                :null}\n\n\n                <h3 className=\"pop\">Sponsored</h3>\n                <SponsorList\n                allWaitings={allWaitings}\n                savedBooks={savedBooks}\n                user={user}/>\n            </div>\n        )\n\n    }\n    else{\n        return <>\n        Error. Please try again\n            <Redirect to =\"/bookindex\"/>\n        </>\n    }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}