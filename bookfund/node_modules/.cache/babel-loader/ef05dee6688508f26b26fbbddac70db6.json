{"ast":null,"code":"import _slicedToArray from\"/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import{useParams,Link}from\"react-router-dom\";import SponsorForm from'./SponsorForm';import ReviewForm from'./ReviewForm';import BookCard from'../BookIndex/BookCard';import{Card,Button,Image}from'semantic-ui-react';import ReactStars from'react-stars';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function BookPage(_ref){var setSavedBooks=_ref.setSavedBooks,savedBooks=_ref.savedBooks,user=_ref.user,setUser=_ref.setUser,reviewLeft=_ref.reviewLeft;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),book=_useState2[0],setBook=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),backEndBook=_useState4[0],setBackEndBook=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),waitlistRequest=_useState6[0],setWaitlistRequest=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),toggleSponsorForm=_useState8[0],setToggleSponsorForm=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),booksFromSearch=_useState10[0],setBooksFromSearch=_useState10[1];var params=useParams();var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),bookId=_useState12[0],setBookId=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),similarIndex=_useState14[0],setSimilarIndex=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),users=_useState16[0],setUsers=_useState16[1];var waitingsMapped=null;var waitingsFulfilledMapped=0;var reviewsMapped=null;var booksMapped=[];var averageRating=0;var sponsorsMapped=[];function stripHtml(html){var tmp=document.createElement(\"DIV\");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||\"\";}useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/books\")).then(function(response){return response.json();}).then(function(data){var foundBook=null;foundBook=data.find(function(book){return book.api_id===params.id;});setBook(foundBook);if(foundBook){setBookId(foundBook.id);setBackEndBook(true);}if(!foundBook){fetch(\"https://www.googleapis.com/books/v1/volumes/\".concat(params.id)).then(function(response){return response.json();}).then(function(data){var title=\"\";var subtitle=\"\";var authors=[\"\"];var publisher=\"\";var publishedDate=\"\";var description=\"\";var image_url=\"\";if(data.volumeInfo.title){title=data.volumeInfo.title;}if(data.volumeInfo.authors){authors=data.volumeInfo.authors;}if(data.volumeInfo.subtitle){subtitle=data.volumeInfo.subtitle;}if(data.volumeInfo.publisher){publisher=data.volumeInfo.publisher;}if(data.volumeInfo.publishedDate){publishedDate=data.volumeInfo.publishedDate;}if(data.volumeInfo.description){description=data.volumeInfo.description;}if(data.volumeInfo.imageLinks){image_url=data.volumeInfo.imageLinks.thumbnail;}setBook({title:title,subtitle:subtitle,authors:authors.join(\", \"),publisher:publisher,publishedDate:publishedDate,description:stripHtml(description),image_url:image_url,api_id:data.id,waitings:[],reviews:[]});});}});fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/users\")).then(function(response){return response.json();}).then(function(data){return setUsers(data);});},[waitlistRequest,backEndBook,params.id,bookId]);useEffect(function(){if(book){if(book.title){var searchTerms=book.title.split(\" \").pop();fetch(\"https://www.googleapis.com/books/v1/volumes?q=\".concat(searchTerms,\"&maxResults=20\")).then(function(response){return response.json();}).then(function(data){setBooksFromSearch(data.items);});}}},[book]);function storeInDB(){if(user){var confObj={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(book)};fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/books\"),confObj).then(function(response){return response.json();}).then(function(data){setBook(data);setBookId(data.id);setBackEndBook(true);setWaitlistRequest(!waitlistRequest);});}else{alert('Please sign in to leave a review.');}}function waitListRequestAndStoreInDBRequest(){if(user){var confObj={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(book)};fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/books\"),confObj).then(function(response){return response.json();}).then(function(data){setBook(data);setBookId(data.id);var bookIdea=data.id;var confObj={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,book_id:bookIdea,fulfilled:false})};fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/waitings\"),confObj).then(function(response){return response.json();}).then(function(data){setBackEndBook(true);setWaitlistRequest(!waitlistRequest);if(data.error){alert(\"\".concat(data.error));}// else{\n//     fetch(`${process.env.REACT_APP_API_BASE_URL}/books`)\n//     .then(response=>response.json())\n//     .then(data=>setSavedBooks(data))\n// }\n});});}else{alert('Please sign in to join a waitlist.');}}if(booksFromSearch.length>0){booksMapped=booksFromSearch.slice(similarIndex,similarIndex+3).map(function(book){return/*#__PURE__*/_jsx(BookCard,{book:book});});}if(backEndBook===true&&book){if(users.length>0){var sponsorsFiltered=book.waitings.filter(function(waiting){return waiting.fulfilled===true;});var arr=[];sponsorsMapped=sponsorsFiltered.map(function(waiting){var x=sponsorsFiltered.filter(function(wait){return wait.sponsor_id===waiting.sponsor_id;}).length;if(arr.find(function(elem){return elem===waiting.sponsor_id;})){return null;}else{arr.push(waiting.sponsor_id);return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(Image,{src:users.find(function(user){return user.id===waiting.sponsor_id;}).profile_pic?users.find(function(user){return user.id===waiting.sponsor_id;}).profile_pic:\"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\",size:\"mini\",circular:true}),/*#__PURE__*/_jsx(Link,{to:\"/otheruserpage/\".concat(waiting.sponsor_id),children:users.find(function(user){return user.id===waiting.sponsor_id;}).username}),/*#__PURE__*/_jsxs(\"div\",{style:{float:'right'},children:[\" \",x,\" \",x===1?\" copy\":\"copies\"]})]});}});sponsorsMapped=sponsorsMapped.filter(function(waiting){return waiting!==null;});}waitingsMapped=book.waitings.filter(function(waiting){return waiting.fulfilled!==true;}).map(function(waiting){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(Image,{src:waiting.user.profile_pic?waiting.user.profile_pic:\"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\",size:\"mini\",circular:true}),/*#__PURE__*/_jsxs(Link,{to:\"/otheruserpage/\".concat(waiting.user.id),children:[waiting.user.username,\" \",waiting.user.eligible?\"(eligible)\":\"(ineligible)\"]})]});});waitingsFulfilledMapped=book.waitings.filter(function(waiting){return waiting.fulfilled===true;}).map(function(waiting){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(Image,{src:waiting.user.profile_pic?waiting.user.profile_pic:\"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\",size:\"mini\",circular:true}),/*#__PURE__*/_jsx(Link,{to:\"/otheruserpage/\".concat(waiting.user.id),children:waiting.user.username})]});});reviewsMapped=book.reviews.map(function(review){if(user){var reducer=function reducer(accumulator,currentValue){return accumulator+currentValue;};averageRating=book.reviews.map(function(review){return review.rating;}).reduce(reducer)/book.reviews.length;return/*#__PURE__*/_jsxs(\"div\",{className:\"review\",children:[/*#__PURE__*/_jsx(Image,{src:review.user.profile_pic?review.user.profile_pic:\"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\",size:\"mini\",circular:true}),/*#__PURE__*/_jsx(Link,{to:\"/otheruserpage/\".concat(review.user.id),children:review.user.username}),/*#__PURE__*/_jsx(ReactStars,{className:\"react-stars\",count:5,value:review.rating,size:15,color2:'#ffd700',edit:false// style={{fontSize: '20px'}}\n}),review.text,review.user.id===user.id?/*#__PURE__*/_jsx(Button,{size:\"mini\",id:review.id,onClick:function onClick(e){return handleCommentDelete(e);},children:\"Delete\"}):null]});}else{var _reducer=function _reducer(accumulator,currentValue){return accumulator+currentValue;};averageRating=book.reviews.map(function(review){return review.rating;}).reduce(_reducer)/book.reviews.length;return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Image,{src:review.user.profile_pic?review.user.profile_pic:\"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\",size:\"mini\",circular:true}),/*#__PURE__*/_jsx(Link,{to:\"/otheruserpage/\".concat(review.user.id),children:review.user.username}),/*#__PURE__*/_jsx(ReactStars,{className:\"react-stars\",count:5,value:review.rating,size:15,color2:'#ffd700',edit:false})]}),review.text]});}});}function handleCommentDelete(e){var reviewId=parseInt(e.target.id);var confObj={method:'DELETE',headers:{'Content-Type':'application/json'}};fetch(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/reviews/\").concat(reviewId),confObj).then(function(data){return setWaitlistRequest(!waitlistRequest);});}function handleToggleRequest(){if(user){if(backEndBook){setToggleSponsorForm(!toggleSponsorForm);}else{alert(\"There is no one on the waitlist.\");}}else{alert(\"Please log in to Sponsor\");}}function similarNext(){if(similarIndex<booksFromSearch.length-2){setSimilarIndex(similarIndex+3);}else{alert('No More Books to Display');}}function similarBack(){setSimilarIndex(similarIndex-3);}return/*#__PURE__*/_jsxs(\"div\",{className:\"bookpage\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"book-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"book-info-image\",children:/*#__PURE__*/_jsx(Image,{style:{margin:'40px',float:'right'},size:\"small-medium\",src:book?book.image_url:\"N/A\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"book-info-info\",children:[/*#__PURE__*/_jsx(\"h2\",{style:{marginBottom:'-15px'},children:book?book.title:\"N/A\"}),/*#__PURE__*/_jsx(\"h3\",{children:book?book.subtitle:\"N/A\"}),reviewsMapped?/*#__PURE__*/_jsx(ReactStars,{className:\"react-stars\",count:5,value:averageRating,size:20,color2:'#ffd700',edit:false}):null,/*#__PURE__*/_jsx(\"b\",{children:\"by:\"}),\" \",book?book.authors:\"N/A\",\" (\",book?book.publishedDate:\"N/A\",\")\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"b\",{children:\"Publishing House:\"}),\" \",book?book.publisher:\"N/A\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"b\",{children:\"Description:\"}),/*#__PURE__*/_jsx(\"p\",{children:book?book.description:\"N/A\"})]})]}),book?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"reviews\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Reviews\"}),backEndBook&&reviewsMapped.length>0?/*#__PURE__*/_jsxs(\"ul\",{className:\"reviewsUl\",children:[\" \",reviewsMapped,\" \"]}):\"No one has reviewed this book yet. Be the first!\",/*#__PURE__*/_jsx(ReviewForm,{storeInDB:storeInDB,user:user,book:book,waitlistRequest:waitlistRequest,setWaitlistRequest:setWaitlistRequest,backEndBook:backEndBook,setBackEndBook:setBackEndBook,setSavedBooks:setSavedBooks,waitListRequestAndStoreInDBRequest:waitListRequestAndStoreInDBRequest,toggleSponsorForm:toggleSponsorForm,setToggleSponsorForm:setToggleSponsorForm})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bookpage-recipients-list\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{textAlign:'center'},children:\"Recipients\"}),backEndBook&&waitingsFulfilledMapped.length>0?/*#__PURE__*/_jsxs(\"ol\",{children:[\" \",waitingsFulfilledMapped,\"  \"]}):\"No one has received this book yet. Join the waitlist to be the first!\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bookpage-waiting-list\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{textAlign:'center'},children:\"Waitlist\"}),/*#__PURE__*/_jsxs(\"ol\",{children:[backEndBook&&waitingsMapped.length>0?waitingsMapped:\"No one is currently waiting for this book. Be the first!\",\" \"]}),/*#__PURE__*/_jsx(Button,{className:\"waiting-button\",onClick:waitListRequestAndStoreInDBRequest,children:\"Join the Waitlist\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bookpage-sponsor-list\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{textAlign:'center'},children:\"Sponsors\"}),/*#__PURE__*/_jsxs(\"ol\",{children:[backEndBook&&sponsorsMapped.length>0?sponsorsMapped:\"No one has sponsored this book yet.  Be the first!\",\" \"]}),/*#__PURE__*/_jsx(Button,{onClick:handleToggleRequest,children:\" Sponsor this Book\"}),toggleSponsorForm?/*#__PURE__*/_jsx(SponsorForm,{waitingsMapped:waitingsMapped,book:book,user:user,setUser:setUser,waitlistRequest:waitlistRequest,setWaitlistRequest:setWaitlistRequest,setBackEndBook:setBackEndBook,backEndBook:backEndBook,setToggleSponsorForm:setToggleSponsorForm,toggleSponsorForm:toggleSponsorForm}):null]})]}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"similar-books\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Similar Books\"}),booksFromSearch.length>0?/*#__PURE__*/_jsx(Card.Group,{itemsPerRow:3,children:booksMapped}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"buttons-combined\",children:[/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return similarNext(similarIndex+3);},children:\"See More\"}),similarIndex>0?/*#__PURE__*/_jsx(Button,{className:\"next-back-button\",onClick:function onClick(){return similarBack(similarIndex+3);},children:\"Go Back\"}):null]})]})]});}","map":{"version":3,"sources":["/Users/simoncohen/Flatiron/Mod5/bookfund/frontend-bookfund/bookfund/src/components/pages/BookPage/BookPage.js"],"names":["useEffect","useState","useParams","Link","SponsorForm","ReviewForm","BookCard","Card","Button","Image","ReactStars","BookPage","setSavedBooks","savedBooks","user","setUser","reviewLeft","book","setBook","backEndBook","setBackEndBook","waitlistRequest","setWaitlistRequest","toggleSponsorForm","setToggleSponsorForm","booksFromSearch","setBooksFromSearch","params","bookId","setBookId","similarIndex","setSimilarIndex","users","setUsers","waitingsMapped","waitingsFulfilledMapped","reviewsMapped","booksMapped","averageRating","sponsorsMapped","stripHtml","html","tmp","document","createElement","innerHTML","textContent","innerText","fetch","process","env","REACT_APP_API_BASE_URL","then","response","json","data","foundBook","find","api_id","id","title","subtitle","authors","publisher","publishedDate","description","image_url","volumeInfo","imageLinks","thumbnail","join","waitings","reviews","searchTerms","split","pop","items","storeInDB","confObj","method","headers","body","JSON","stringify","alert","waitListRequestAndStoreInDBRequest","bookIdea","user_id","book_id","fulfilled","error","length","slice","map","sponsorsFiltered","filter","waiting","arr","x","wait","sponsor_id","elem","push","profile_pic","username","float","eligible","review","reducer","accumulator","currentValue","rating","reduce","text","e","handleCommentDelete","reviewId","parseInt","target","handleToggleRequest","similarNext","similarBack","margin","marginBottom","textAlign"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useParams, Link,  } from \"react-router-dom\";\nimport SponsorForm from './SponsorForm'\nimport ReviewForm from './ReviewForm'\nimport BookCard from '../BookIndex/BookCard'\nimport { Card, Button, Image } from 'semantic-ui-react'\nimport ReactStars from 'react-stars'\n\nexport default function BookPage({setSavedBooks, savedBooks, user, setUser, reviewLeft}){\n \n    const [book, setBook] = useState ({})\n    const [backEndBook, setBackEndBook] = useState(false)\n    const [waitlistRequest, setWaitlistRequest] = useState(false)\n    const [toggleSponsorForm, setToggleSponsorForm] = useState(false)\n    const [booksFromSearch, setBooksFromSearch] = useState([])\n    const params = useParams()\n    const [bookId, setBookId] = useState(0)\n    const[similarIndex, setSimilarIndex] = useState(0)\n    const [users, setUsers] = useState([])\n\n    let waitingsMapped = null\n    let waitingsFulfilledMapped = 0\n    let reviewsMapped = null\n    let booksMapped = []\n    let averageRating = 0\n    let sponsorsMapped=[]\n\n    function stripHtml(html){\n        let tmp = document.createElement(\"DIV\");\n        tmp.innerHTML = html;\n        return tmp.textContent || tmp.innerText || \"\";\n    }\n\n    useEffect(()=>{\n        fetch(`${process.env.REACT_APP_API_BASE_URL}/books`)\n        .then(response=>response.json())\n        .then(data=>{\n            let foundBook = null\n            foundBook = data.find(book => book.api_id === params.id)\n            setBook(foundBook)\n\n            if (foundBook){\n                setBookId (foundBook.id)\n                setBackEndBook(true)\n            }\n            if (!foundBook){\n                fetch(`https://www.googleapis.com/books/v1/volumes/${params.id}`)\n                .then(response => response.json())\n                .then(data=>{\n                    let title = \"\"\n                    let subtitle = \"\"\n                    let authors = [\"\"]\n                    let publisher = \"\"\n                    let publishedDate = \"\"\n                    let description = \"\"\n                    let image_url = \"\"\n                    if (data.volumeInfo.title){\n                        title = data.volumeInfo.title\n                    }\n                    if (data.volumeInfo.authors){\n                        authors = data.volumeInfo.authors\n                    }\n                    if (data.volumeInfo.subtitle){\n                        subtitle = data.volumeInfo.subtitle\n                    }\n                    if (data.volumeInfo.publisher){\n                        publisher = data.volumeInfo.publisher\n                    }\n                    if (data.volumeInfo.publishedDate){\n                        publishedDate = data.volumeInfo.publishedDate\n                    }\n                    if (data.volumeInfo.description){\n                        description = data.volumeInfo.description\n                    }\n                    if (data.volumeInfo.imageLinks){\n                        image_url = data.volumeInfo.imageLinks.thumbnail\n                    }\n                    setBook({\n                        title: title, \n                        subtitle: subtitle, \n                        authors: authors.join(\", \"), \n                        publisher: publisher, \n                        publishedDate: publishedDate, \n                        description: stripHtml(description),\n                        image_url: image_url, \n                        api_id: data.id, \n                        waitings: [],\n                        reviews: []\n                    })\n                })\n            }\n        })\n\n        fetch(`${process.env.REACT_APP_API_BASE_URL}/users`)\n        .then(response=>response.json())\n        .then(data=>setUsers(data))\n\n    },[waitlistRequest, backEndBook, params.id, bookId])\n\n    useEffect(()=>{\n        if (book){\n            if (book.title){\n                let searchTerms = book.title.split(\" \").pop()\n                fetch(`https://www.googleapis.com/books/v1/volumes?q=${searchTerms}&maxResults=20`)\n                .then(response=>response.json())\n                .then(data=>{\n                    setBooksFromSearch(data.items)\n                })\n            }\n        }\n    },[book])\n\n    function storeInDB(){\n        if (user){\n            let confObj = {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(book),\n            }\n            fetch(`${process.env.REACT_APP_API_BASE_URL}/books`, confObj)\n            .then(response=>response.json())\n            .then(data=>{\n                setBook(data)\n                setBookId(data.id)\n                setBackEndBook(true)\n                setWaitlistRequest(!waitlistRequest)\n            })\n        }\n        else{\n            alert('Please sign in to leave a review.')\n        }\n    }\n\n\n   \n\n    function waitListRequestAndStoreInDBRequest (){\n        if (user){\n            let confObj = {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(book),\n            }\n            fetch(`${process.env.REACT_APP_API_BASE_URL}/books`, confObj)\n            .then(response=>response.json())\n            .then(data=>{\n                setBook(data)\n                setBookId(data.id)\n                let bookIdea = data.id\n                let confObj = {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({user_id: user.id, book_id: bookIdea, fulfilled: false}),\n                }\n                fetch(`${process.env.REACT_APP_API_BASE_URL}/waitings`, confObj)\n                .then(response=>response.json())\n                .then(data=>{                  \n                    setBackEndBook(true)\n                    setWaitlistRequest(!waitlistRequest)\n                    if (data.error){\n                        alert(`${data.error}`)\n                    }\n                    // else{\n                    //     fetch(`${process.env.REACT_APP_API_BASE_URL}/books`)\n                    //     .then(response=>response.json())\n                    //     .then(data=>setSavedBooks(data))\n                    // }\n                })\n            })\n        }\n\n        else{\n            alert('Please sign in to join a waitlist.')\n        }\n    }\n\n    if (booksFromSearch.length > 0){\n         booksMapped = booksFromSearch.slice(similarIndex, similarIndex+3).map(book=>{\n            return(\n                <BookCard book = {book}/>\n            )\n        })\n    }\n   \n    \n\n    if (backEndBook === true && book){\n         if (users.length > 0){\n            let sponsorsFiltered = book.waitings.filter(waiting=>waiting.fulfilled===true)\n            let arr = []\n            sponsorsMapped = sponsorsFiltered.map(waiting=>{\n                let x = sponsorsFiltered.filter(wait=>wait.sponsor_id===waiting.sponsor_id).length\n\n                if (arr.find(elem=>elem===waiting.sponsor_id)){\n                    return null\n                }\n                else{\n                arr.push(waiting.sponsor_id)\n                    return(\n                    <li>\n                        <Image src={users.find(user=>user.id===waiting.sponsor_id).profile_pic  ? users.find(user=>user.id===waiting.sponsor_id).profile_pic : \"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\"} size='mini' circular />\n                        <Link to={`/otheruserpage/${waiting.sponsor_id}`}>\n                            {users.find(user=>user.id===waiting.sponsor_id).username} \n                        </Link>\n                        <div style={{float: 'right'}}> {x} {x === 1 ? \" copy\" : \"copies\"}</div>\n                    </li>)\n                }\n            })\n            sponsorsMapped = sponsorsMapped.filter(waiting=>waiting!==null)\n        }\n         \n        waitingsMapped = book.waitings.filter(waiting => waiting.fulfilled !== true).map(waiting=>{\n            return(\n            <li>\n                <Image src={waiting.user.profile_pic ? waiting.user.profile_pic : \"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\"} size='mini' circular />\n                <Link to={`/otheruserpage/${waiting.user.id}`}>\n                    {waiting.user.username} {waiting.user.eligible? \"(eligible)\": \"(ineligible)\"}\n                </Link>\n            </li>)\n        })\n        \n       \n        \n        waitingsFulfilledMapped = book.waitings.filter(waiting => waiting.fulfilled === true).map(waiting=>{\n            return(\n            <li>\n                <Image src={waiting.user.profile_pic ? waiting.user.profile_pic : \"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\"} size='mini' circular />\n                <Link to={`/otheruserpage/${waiting.user.id}`}>{waiting.user.username}</Link>\n            </li>)\n        })\n\n        reviewsMapped = book.reviews.map(review=>{  \n            \n            if (user){\n                let reducer = (accumulator, currentValue) => accumulator + currentValue;\n                averageRating = book.reviews.map(review=>review.rating).reduce(reducer)/book.reviews.length\n                return(\n                    <div className=\"review\">\n                        <Image src={review.user.profile_pic ? review.user.profile_pic : \"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\"} size='mini'  circular/>\n                        <Link to={`/otheruserpage/${review.user.id}`}>{review.user.username}</Link> \n                        <ReactStars\n                            className=\"react-stars\"\n                            count={5}\n                            value={review.rating}\n                            size={15}\n                            color2={'#ffd700'}\n                            edit={false}\n                            // style={{fontSize: '20px'}}\n                        />\n                        {review.text} \n                        {review.user.id === user.id ? <Button size='mini' id={review.id} onClick={e=>handleCommentDelete(e)}>Delete</Button> :null}\n                    </div>\n                )   \n            }\n            else{\n                let reducer = (accumulator, currentValue) => accumulator + currentValue;\n                averageRating = book.reviews.map(review=>review.rating).reduce(reducer)/book.reviews.length\n                return(\n                    <li>\n                        <div>\n                            <Image src={review.user.profile_pic ? review.user.profile_pic : \"https://www.xovi.com/wp-content/plugins/all-in-one-seo-pack/images/default-user-image.png\"} size='mini' circular />\n                            <Link to={`/otheruserpage/${review.user.id}`}>{review.user.username}</Link> \n                            <ReactStars\n                                className=\"react-stars\"\n                                count={5}\n                                value={review.rating}\n                                size={15}\n                                color2={'#ffd700'}\n                                edit={false}\n                            />\n                        </div>\n                        {review.text} \n                    </li>\n                )   \n            }\n        })\n    }\n\n    function handleCommentDelete(e){\n        let reviewId = parseInt(e.target.id)\n        let confObj = {\n            method: 'DELETE',\n            headers: {\n                'Content-Type': 'application/json',\n            }\n        }\n        fetch(`${process.env.REACT_APP_API_BASE_URL}/reviews/${reviewId}`, confObj)\n        .then(data=>setWaitlistRequest(!waitlistRequest))\n\n    }\n\n    function handleToggleRequest(){\n        if (user){\n            if (backEndBook){\n                setToggleSponsorForm(!toggleSponsorForm)\n            }\n            else{\n                alert(\"There is no one on the waitlist.\")\n            }\n        }\n        else{\n        alert(\"Please log in to Sponsor\")\n        }\n    }\n\n    function similarNext(){\n        if (similarIndex < booksFromSearch.length - 2){\n            setSimilarIndex(similarIndex+3)\n        }\n        else{\n            alert('No More Books to Display')\n        }\n    }\n\n    function similarBack(){\n        setSimilarIndex(similarIndex-3)\n    }\n\n    return(\n        <div className=\"bookpage\">\n            <div className=\"book-info\">\n                <div className=\"book-info-image\">\n                    <Image style={{margin: '40px', float:'right'}}size='small-medium'src={ book ? book.image_url: \"N/A\" }/>\n                </div>\n                <div className=\"book-info-info\">\n                    <h2 style={{marginBottom: '-15px'}}>{book? book.title: \"N/A\"}</h2>\n                    <h3>{book? book.subtitle: \"N/A\"}</h3>\n                    {reviewsMapped ? \n                        <ReactStars\n                            className=\"react-stars\"\n                            count={5}\n                            value={averageRating}\n                            size={20}\n                            color2={'#ffd700'}\n                            edit={false}\n                        />\n                    : null}\n                \n                        <b>by:</b> {book? book.authors: \"N/A\"} ({book? book.publishedDate: \"N/A\"})\n                    \n                        <br></br>\n                        <b>Publishing House:</b> {book? book.publisher: \"N/A\"}\n                        <br></br>\n                        \n                        <b>Description:</b> \n                        <p>\n                            {book? book.description: \"N/A\"} \n                        </p>\n                </div>\n\n\n            </div>\n            \n\n            { book ? \n            <>\n                <div className=\"reviews\">\n                    <h3>Reviews</h3>\n                    {backEndBook && reviewsMapped.length > 0 ? \n                        <ul className=\"reviewsUl\"> {reviewsMapped} </ul> \n                    : \"No one has reviewed this book yet. Be the first!\"} \n                    <ReviewForm \n                    storeInDB={storeInDB}\n                    user={user} \n                    book={book} \n                    waitlistRequest={waitlistRequest} \n                    setWaitlistRequest={setWaitlistRequest}\n                    backEndBook={backEndBook}\n                    setBackEndBook={setBackEndBook}\n                    setSavedBooks={setSavedBooks}\n                    waitListRequestAndStoreInDBRequest={waitListRequestAndStoreInDBRequest}\n                    toggleSponsorForm={toggleSponsorForm} \n                    setToggleSponsorForm={setToggleSponsorForm}/>\n                </div>\n\n                <div className=\"bookpage-recipients-list\">\n                    <h3  style={{textAlign: 'center'}}>Recipients</h3>\n                    {backEndBook && waitingsFulfilledMapped.length > 0 ? <ol> {waitingsFulfilledMapped}  </ol>: \"No one has received this book yet. Join the waitlist to be the first!\"}\n                        \n                </div>\n                <div className= \"bookpage-waiting-list\">\n                    <h3 style={{textAlign: 'center'}}>Waitlist</h3>\n                    <ol>{ backEndBook && waitingsMapped.length > 0 ? waitingsMapped: \"No one is currently waiting for this book. Be the first!\"} </ol>\n                    <Button className=\"waiting-button\" onClick={waitListRequestAndStoreInDBRequest}>Join the Waitlist</Button>\n\n                </div>\n                <div className= \"bookpage-sponsor-list\">\n                    <h3 style={{textAlign: 'center'}}>Sponsors</h3>\n                    <ol>{ backEndBook && sponsorsMapped.length > 0 ? sponsorsMapped: \"No one has sponsored this book yet.  Be the first!\"} </ol>\n                    <Button onClick={handleToggleRequest}> Sponsor this Book</Button>\n                        {toggleSponsorForm ? \n                            <SponsorForm \n                                waitingsMapped={waitingsMapped} \n                                book={book} \n                                user={user}\n                                setUser={setUser}\n                                waitlistRequest={waitlistRequest}\n                                setWaitlistRequest={setWaitlistRequest}\n                                setBackEndBook={setBackEndBook}\n                                backEndBook={backEndBook}\n                                setToggleSponsorForm={setToggleSponsorForm}\n                                toggleSponsorForm={ toggleSponsorForm}\n                            /> \n                        : null}\n                </div>\n                </>\n            : null\n            }\n            <div className = \"similar-books\">\n                <h3>Similar Books</h3>\n                {booksFromSearch.length > 0 ? \n                    <Card.Group itemsPerRow={3}>\n                        {booksMapped}  \n                    </Card.Group>\n                : null}\n                \n                <div className=\"buttons-combined\">\n                    <Button className=\"next-back-button\" onClick={()=>similarNext(similarIndex+3)}>See More</Button>\n                    {similarIndex > 0 ? <Button className=\"next-back-button\" onClick={()=>similarBack(similarIndex+3)}>Go Back</Button>: null}\n                </div>\n            </div>\n            \n        </div>\n    )\n\n}\n\n\n\n\n\n\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}